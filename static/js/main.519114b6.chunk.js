(this["webpackJsonpfarmacias-voronoi"]=this["webpackJsonpfarmacias-voronoi"]||[]).push([[0],{24:function(e,t,a){e.exports=a(74)},35:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},39:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){"use strict";a.r(t);var r=a(0),o=a.n(r),n=a(12),c=a.n(n),i=a(3),s=a(2),l={selectedLayer:""},u=Object(r.createContext)(l),p=u.Provider,d=a(1),m=a.n(d),f=a(5),y=a(4),b=function(e){var t=e.config,a=e.sourceLoad,r=o.a.useState({}),n=Object(s.a)(r,2),c=n[0],l=n[1];o.a.useEffect((function(){if(t){for(var e={},a=0,r=Object.values(t);a<r.length;a++){var o=r[a];e=Object(i.a)({},e,Object(y.a)({},o.id,!1))}l(e)}}),[t]),o.a.useEffect((function(){c&&(Object.keys(c).every((function(e){return!0===c[e]}))&&a(!0))}),[c]);return o.a.createElement(o.a.Fragment,null,Object.values(t).map((function(e){return e.isSource&&o.a.createElement(f.d,{key:e.sourceId,id:e.sourceId,tileJsonSource:{type:"vector",tiles:e.pbf,promoteId:e.promoteId||void 0},onSourceLoaded:function(){return t=e.id,void l(Object(i.a)({},c,Object(y.a)({},t,!0)));var t}})})))},h=a(8),v=a.n(h),g=a(6),_=a(7),I=function(){function e(t){Object(g.a)(this,e),this.map=t.map,this.id=t.id,this.sourceId=t.sourceId,this.sourceLayer=t.sourceLayer,this.popupFieldsConfig=t.popupFieldsConfig||{},this._hoveredFeature=0,this._hoveredId=null,this._popupInfo={}}return Object(_.a)(e,[{key:"mouseMove",value:function(e){this.map.getCanvas().style.cursor="pointer",e.features.length>0&&(this._hoveredId&&this.map.setFeatureState({source:this.sourceId,id:this._hoveredId,sourceLayer:this.sourceLayer},{hover:!1}),this._hoveredId=e.features[0].id,this.map.setFeatureState({source:this.sourceId,id:this._hoveredId,sourceLayer:this.sourceLayer},{hover:!0}));for(var t=e.lngLat,a=Object.keys(this.popupFieldsConfig),r=e.features[0].properties,o=0,n=a;o<n.length;o++){var c=n[o];r.hasOwnProperty(c)&&(this._popupInfo=Object(i.a)({},this._popupInfo,{coords:[t.lng,t.lat],shouldRender:!0,info:Object(i.a)({},this._popupInfo.info,Object(y.a)({},c,Object(i.a)({},this.popupFieldsConfig[c],{value:r[c]})))}))}}},{key:"mouseLeave",value:function(){this.map.getCanvas().style.cursor="",this._popupInfo={shouldRender:!1},this._hoveredId&&this.map.setFeatureState({source:this.sourceId,id:this._hoveredId,sourceLayer:this.sourceLayer},{hover:!1}),this._hoveredId=null}},{key:"popupInfo",get:function(){return this._popupInfo}}]),e}();function O(e,t){var a=Object(r.useState)({shouldRender:!1}),n=Object(s.a)(a,2),c=n[0],i=n[1],l=Object(r.useState)(null),u=Object(s.a)(l,2),p=u[0],d=u[1];return o.a.useEffect((function(){return e&&t&&function(){for(var a=e,r=[],o=Object.values(t),n=0;n<o.length;n+=1)r.push(new I({map:a,id:o[n].id,sourceId:o[n].sourceId,sourceLayer:o[n].sourceLayer,popupFieldsConfig:o[n].popupFieldsConfig}));for(var c=function(e){a.on("mousemove",o[e].id,(function(t){r[e].mouseMove(t);var a=r[e].popupInfo;a&&i(a)})),a.on("mouseleave",o[e].id,(function(){r[e].mouseLeave();var t=r[e].popupInfo;t&&i(t)})),a.on("click",o[e].id,(function(e){0!==e.features.length&&d(e.features[0])})),a.on("touchstart",o[e].id,(function(e){0!==e.features.length&&d(e.features[0])}))},s=0;s<o.length;s+=1)c(s)}(),function(){!function(){for(var a=e,r=0,o=Object.values(t);r<o.length;r++){var n=o[r];a.off("mousemove",n),a.off("mouseleave",n)}}()}}),[e,t]),[c,p]}O.propTypes={map:v.a.instanceOf(d.Map).isRequired,layersIds:v.a.shape({cadastre_id:v.a.object}).isRequired};a(35);var j=function(e){var t=e.mapObject,a=o.a.useState(!0),r=Object(s.a)(a,2),n=r[0],c=r[1];return o.a.useEffect((function(){var e=!1;t&&t.once("styledata",(function(){!function a(){t.isStyleLoaded()?(e||c(!1),e=!0):setTimeout(a,200)}()}))}),[t]),o.a.createElement("div",{className:"".concat(n?"loader":"loader--close")},o.a.createElement("div",{className:"CDB-LoaderIcon CDB-LoaderIcon--big"},o.a.createElement("svg",{className:"CDB-LoaderIcon-spinner",viewBox:"0 0 50 50"},o.a.createElement("circle",{className:"CDB-LoaderIcon-path",cx:"25",cy:"25",r:"20",fill:"none"}))))};j.defaultProps={mapObject:d.Map};a(36);var E=o.a.memo((function(e){var t=e.content,a=o.a.useState([]),n=Object(s.a)(a,2),c=n[0],i=n[1];o.a.useEffect((function(){t&&i(Object.values(t))}),[t]);return o.a.createElement("div",{className:"popup-template"},c&&c.map((function(e,t){return o.a.createElement(r.Fragment,{key:"dynamic-".concat(t)},o.a.createElement("span",{className:"popup-template--static popup-template--static-".concat(t+1)},e.fieldLabel),o.a.createElement("div",{className:"popup-template--dynamic popup-template--dynamic-".concat(t+1)},o.a.createElement("span",null,"number"===typeof(a=e.value)?"".concat(new Intl.NumberFormat("es").format(a)):a),o.a.createElement("span",null,e.label)));var a})))}),(function(e,t){return e.content===t.content})),k=(a(37),{"top-right":{top:"1rem",right:"1rem",bottom:"auto",left:"auto"},"top-left":{top:"1rem",left:"1rem",bottom:"auto",right:"auto"},"bottom-right":{bottom:"1rem",right:"1rem",top:"auto",left:"auto"},"bottom-left":{bottom:"1rem",left:"1rem",top:"auto",right:"auto"}}),w=Object.keys(k),L=function(e){var t=e.children,a=e.position;return o.a.createElement("div",{className:"map-container",style:Object(i.a)({},k[a])},Array.isArray(t)?t:[t].map((function(e,t){return o.a.createElement("div",{key:"widget-".concat(t+1),className:"map-container__child"},e)})))};L.defaultProps={position:w[0]};a(38),a(39);var S=function(e){var t=e.mapObject,a=e.layers,r=o.a.useContext(u),n=r.state,c=r.dispatch;o.a.useEffect((function(){if(a){var e=!0,t=!1,r=void 0;try{for(var o,n=a[Symbol.iterator]();!(e=(o=n.next()).done);e=!0){var i=o.value;i.shouldShowOnInit&&c({type:"switch layer",payload:i.layersIds[0]})}}catch(s){t=!0,r=s}finally{try{e||null==n.return||n.return()}finally{if(t)throw r}}}}),[]);var i=function(e){var r=e.target.name;c({type:"switch layer",payload:r});var o=!0,n=!1,i=void 0;try{for(var s,l=a[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){var u=s.value,p=!0,d=!1,m=void 0;try{for(var f,y=u.layersIds[Symbol.iterator]();!(p=(f=y.next()).done);p=!0){var b=f.value;t.getLayer(b)&&("visible"===t.getLayoutProperty(b,"visibility")?t.setLayoutProperty(b,"visibility","none"):t.setLayoutProperty(b,"visibility","visible"))}}catch(h){d=!0,m=h}finally{try{p||null==y.return||y.return()}finally{if(d)throw m}}}}catch(h){n=!0,i=h}finally{try{o||null==l.return||l.return()}finally{if(n)throw i}}};return o.a.createElement("div",{className:"layers-picker"},n.selectedLayer&&a.map((function(e,t){return o.a.createElement("div",{key:e.layersIds[0],className:"as-radio"},o.a.createElement("input",{className:"as-radio__input",type:"radio",name:e.layersIds[0],id:e.layersIds[0],value:t,checked:n.selectedLayer===e.layersIds[0],onChange:i}),o.a.createElement("label",{className:"as-caption",htmlFor:e.layersIds[0]},e.layerTitle))})))},C=a(22),x=a.n(C),F=(a(70),function(e){var t=e.mapObject,a=o.a.useRef(null);return o.a.useEffect((function(){var e=new x.a({accessToken:"pk.eyJ1IjoiZG90Z2lzIiwiYSI6ImNrN3o0bmt4NzAyNXEzam9naXVqbm5vb2wifQ.irrtd8SmU9Ce_iQRUAqxEQ",mapboxgl:m.a,marker:{color:"#03fcad"},placeholder:"Buscar direcci\xf3n"});a.current.appendChild(e.onAdd(t))}),[a]),o.a.createElement("div",{ref:a,className:"calculator-geocoder"})}),T="dotgis",N="wqTxcWJUw09P4IzpBo4kfg",q="voronoi",M="voronoi_source",A="voronoi_source_layer",R="pharmacy",z="pharmacy_source_id",Z="pharmacy_source_layer",B="pharmacy_aggregated",K="supermarkets_voronoi",P="supermarkets_voronoi_source_id",J="supermarkets_voronoi_source_layer",D="supermarkets",G="supermarkets_source_id",Q="supermarkets_source_layer",U="supermarkets_aggregated",Y=function(e){var t=e.map,a=e.config,r=(o.a.useContext(u),O(t,a)),n=Object(s.a)(r,2),c=n[0],i=n[1];return o.a.useEffect((function(){if(i&&(i.source===z||i.source===G)){var e=i.geometry.coordinates;t.flyTo({center:e,zoom:Math.round(t.getZoom()+2),essential:!0})}}),[i]),o.a.createElement(o.a.Fragment,null,Object.values(a).map((function(e){return!e.isSource&&o.a.createElement(f.a,Object.assign({key:e.id,id:e.id,type:e.type,sourceId:e.sourceId,sourceLayer:e.sourceLayer,paint:e.paint},e.layout&&{layout:e.layout},e.minZoom&&{minZoom:e.minZoom},e.maxZoom&&{maxZoom:e.maxZoom}))})),c&&c.coords&&o.a.createElement(f.c,{coordinates:c.coords,style:{display:c.shouldRender?"":"none"},offset:{bottom:[0,80]}},o.a.createElement(E,{content:c.info})))},V=a(10),W=a.n(V),X=a(13),H=function(){function e(t){Object(g.a)(this,e),this.cartoAccount=t.cartoAccount,this.cartoMapsKey=t.cartoMapsKey,this.id=t.id,this.sql=t.sql,this.getGeoJSON=t.getGeoJSON,this.aggregationConfig=t.aggregationConfig}return Object(_.a)(e,[{key:"getTiles",value:function(){var e=Object(X.a)(W.a.mark((function e(){var t,a,r;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={buffersize:{mvt:1},layers:[{id:this.id,type:"mapnik",options:{sql:this.sql,aggregation:this.aggregationConfig||void 0,id:"cartodb_id"}}]},e.next=3,fetch("https://".concat(this.cartoAccount,".carto.com/api/v1/map").concat(this.cartoMapsKey?"?api_key=".concat(this.cartoMapsKey):""),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:return a=e.sent,e.next=6,a.json();case 6:return r=e.sent,e.abrupt("return",r.metadata.tilejson.vector.tiles);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestInfo",get:function(){return{carto_account:this.cartoAccount,carto_maps_key:this.cartoMapsKey,request_id:this.id,sql_query:this.sql,aggregation_config:this.aggregationConfig||void 0}}},{key:"updateSql",set:function(e){this.sql=e}}]),e}(),$="SELECT * FROM voronoi_farmacias",ee="SELECT * FROM farmacias",te="SELECT * FROM voronoi_supermkt_madrid",ae="SELECT * FROM supermercados_madrid",re={voronoi:{"fill-color":["case",["boolean",["feature-state","hover"],!1],"rgba(204, 102, 255, 0.15)","rgba(204, 102, 255, 0.1)"],"fill-outline-color":"rgba(204, 102, 255, 0.3)"},cluster:function(e){return{"circle-color":["step",["get",e],"rgba(0, 0, 0, 0)",100,"#b4d9cc",750,"#63a6a0",2e3,"#287274"],"circle-radius":["case",[">",["get",e],1],["step",["get",e],20,100,30,750,40],6]}},pharmacy:{"circle-color":["case",["boolean",["feature-state","hover"],!1],"rgb(255, 102, 0)","rgb(0, 255, 0)"],"circle-radius":["interpolate",["exponential",.7],["zoom"],4,0,10,3,15,5,20,7]},supermarket:{"circle-color":["case",["boolean",["feature-state","hover"],!1],"rgb(255, 102, 0)","rgb(0, 102, 255)"],"circle-radius":["interpolate",["exponential",.7],["zoom"],4,0,10,3,15,5,20,7]},label_paint:function(e){return{textColor:{"text-color":["case",[">",["get",e],100],"#333","rgba(0, 0, 0, 0)"]},layout:{"text-field":"{".concat(e,"}"),"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":["step",["get",e],12,100,13,750,14],"text-allow-overlap":!0}}}};function oe(){var e=Object(r.useState)(null),t=Object(s.a)(e,2),a=t[0],n=t[1],c=function(){var e=Object(X.a)(W.a.mark((function e(){var t,a,r,o,c,s;return W.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new H({cartoAccount:T,cartoMapsKey:N,id:A,sql:$}),a=new H({cartoAccount:T,cartoMapsKey:N,id:Z,sql:ee,aggregationConfig:{threshold:1,placement:"centroid",columns:Object(y.a)({},B,{aggregate_function:"count",aggregated_column:"rid"}),filters:Object(y.a)({},B,{greater_than:1}),resolution:64}}),r=new H({cartoAccount:T,cartoMapsKey:N,id:"".concat(Z,"_raw"),sql:ee}),o=new H({cartoAccount:T,cartoMapsKey:N,id:"".concat(Q,"_raw"),sql:ae}),c=new H({cartoAccount:T,cartoMapsKey:N,id:Q,sql:ae,aggregationConfig:{threshold:1,placement:"centroid",columns:Object(y.a)({},U,{aggregate_function:"count",aggregated_column:"id_super"}),filters:Object(y.a)({},U,{greater_than:1}),resolution:64}}),s=new H({cartoAccount:T,cartoMapsKey:N,id:J,sql:te}),Promise.all([t.getTiles(),a.getTiles(),r.getTiles(),o.getTiles(),c.getTiles(),s.getTiles()]).then((function(e){n({pharmacy_voronoi_source:{isSource:!0,sourceId:M,pbf:e[0],promoteId:"cartodb_id"},pharmacy_voronoi_layer:{id:q,sourceId:M,sourceLayer:A,type:"fill",paint:re.voronoi,layout:{visibility:"visible"}},pharmacy_raw_source:{isSource:!0,sourceId:"".concat(z,"_raw"),pbf:e[2],promoteId:"cartodb_id"},pharmacy_raw_layer:{id:"".concat(R,"_raw"),sourceId:"".concat(z,"_raw"),sourceLayer:"".concat(Z,"_raw"),type:"circle",paint:re.pharmacy,popupFieldsConfig:{nombre:{fieldLabel:"Nombre",label:""},direccion:{fieldLabel:"Direcci\xf3n",label:""}},layout:{visibility:"visible"}},pharmacy_cluster_source:{isSource:!0,sourceId:z,pbf:e[1],promoteId:"cartodb_id"},pharmacy_cluster_layer:{id:R,sourceId:z,sourceLayer:Z,type:"circle",paint:re.cluster(B),layout:{visibility:"visible"}},pharmacy_cluster_labels_layer:{id:"".concat(R,"_labels"),sourceId:z,sourceLayer:Z,type:"symbol",paint:re.label_paint(B).textColor,layout:Object(i.a)({visibility:"visible"},re.label_paint(B).layout)},supermarkets_voronoi_source:{isSource:!0,sourceId:P,pbf:e[5],promoteId:"cartodb_id"},supermarkets_voronoi_layer:{id:K,sourceId:P,sourceLayer:J,type:"fill",paint:re.voronoi,layout:{visibility:"none"}},supermarkets_raw_source:{isSource:!0,sourceId:"".concat(G,"_raw"),pbf:e[3],promoteId:"cartodb_id"},supermarkets_raw_layer:{id:"".concat(D,"_raw"),sourceId:"".concat(G,"_raw"),sourceLayer:"".concat(Q,"_raw"),type:"circle",paint:re.supermarket,popupFieldsConfig:{nombre:{fieldLabel:"Nombre",label:""},direccion:{fieldLabel:"Direcci\xf3n",label:""}},layout:{visibility:"none"}},supermarkets_cluster_source:{isSource:!0,sourceId:G,pbf:e[4],promoteId:"cartodb_id"},supermarkets_cluster_layer:{id:D,sourceId:G,sourceLayer:Q,type:"circle",paint:re.cluster(U),layout:{visibility:"none"}},supermarket_cluster_labels_layer:{id:"".concat(D,"_labels"),sourceId:G,sourceLayer:Q,pbf:e[4],promoteId:"cartodb_id",type:"symbol",paint:re.label_paint(U).textColor,layout:Object(i.a)({visibility:"none"},re.label_paint(U).layout)}})}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return o.a.useEffect((function(){c()}),[]),[a]}oe.propTypes={mapFilters:v.a.oneOfType([v.a.object]).isRequired};var ne=a(23),ce=Object(f.f)({accessToken:"pk.eyJ1IjoiZG90Z2lzIiwiYSI6ImNqd3Z6amtjMTBjOTA0OW84ZjVvYzF6bjQifQ.LIbUaYq3GaiWTzsBV6YnTA"}),ie=[{shouldShowOnInit:!0,layersIds:[R,q,"".concat(R,"_raw"),"".concat(R,"_labels")],layerTitle:"Farmacias",layerColor:"rgb(0, 255, 0)"},{shouldShowOnInit:!1,layersIds:[D,K,"".concat(D,"_raw"),"".concat(D,"_labels")],layerTitle:"Supermercados",layerColor:"rgb(0, 102, 255)"}],se=function(){var e=o.a.useState(!1),t=Object(s.a)(e,2),a=t[0],r=t[1],n=o.a.useState(null),c=Object(s.a)(n,2),i=c[0],l=c[1],u=oe(),p=Object(s.a)(u,1)[0];return o.a.createElement(o.a.Fragment,null,(!!m.a.supported()||(alert("Tu navegador no soporta Mapbox GL JS."),!1))&&o.a.createElement(o.a.Fragment,null,i&&o.a.createElement(o.a.Fragment,null,o.a.createElement(j,{mapObject:i}),o.a.createElement(L,{position:"top-left"},o.a.createElement(F,{mapObject:i})),o.a.createElement(L,{position:ne.isMobile?"bottom-right":"top-right"},o.a.createElement(S,{key:"layer-picker",mapObject:i,layers:ie}))),o.a.createElement(ce,{style:"mapbox://styles/mapbox/dark-v10",fitBounds:[[-4.2129351236574735,40.23670360815473],[-3.1320186657642637,40.64109281781327]],containerStyle:{position:"absolute",width:"100%",height:"100%"}},o.a.createElement(f.b.Consumer,null,(function(e){return l(e),o.a.createElement(o.a.Fragment,null,p&&o.a.createElement(o.a.Fragment,null,o.a.createElement(b,{key:"sources",config:p,sourceLoad:function(e){return r(e)}}),a&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Y,{key:"map",map:e,config:p})),o.a.createElement(f.e,{key:"zoom-control",position:"bottom-left"})))})))))},le=(a(73),o.a.createElement((function(e){var t=e.children,a=Object(r.useReducer)((function(e,t){switch(t.type){case"switch layer":return Object(i.a)({},e,{selectedLayer:t.payload});default:return e}}),l),n=Object(s.a)(a,2),c=n[0],u=n[1];return o.a.createElement(p,{value:{state:c,dispatch:u}},t)}),null,o.a.createElement(se,null)));c.a.render(le,document.getElementById("root"))}},[[24,1,2]]]);
//# sourceMappingURL=main.519114b6.chunk.js.map