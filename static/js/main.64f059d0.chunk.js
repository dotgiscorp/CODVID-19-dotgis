(this["webpackJsonpfarmacias-voronoi"]=this["webpackJsonpfarmacias-voronoi"]||[]).push([[0],{16:function(e,t,a){e.exports=a(33)},21:function(e,t,a){},28:function(e,t,a){},29:function(e,t,a){},30:function(e,t,a){},33:function(e,t,a){"use strict";a.r(t);var o=a(0),r=a.n(o),n=a(10),i=a.n(n),c=(a(21),a(2)),s=a(1),l=a.n(s),u=a(5),p=a(3),d=a(4),m=function(e){var t=e.config,a=e.sourceLoad,o=r.a.useState({}),n=Object(c.a)(o,2),i=n[0],s=n[1];r.a.useEffect((function(){if(t){for(var e={},a=0,o=Object.values(t);a<o.length;a++){var r=o[a];e=Object(d.a)({},e,Object(p.a)({},r.id,!1))}s(e)}}),[t]),r.a.useEffect((function(){i&&(Object.keys(i).every((function(e){return!0===i[e]}))&&a(!0))}),[i]);return r.a.createElement(r.a.Fragment,null,Object.values(t).map((function(e){return e.isSource&&r.a.createElement(u.d,{key:e.sourceId,id:e.sourceId,tileJsonSource:{type:"vector",tiles:e.pbf,promoteId:e.promoteId||void 0},onSourceLoaded:function(){return t=e.id,void s(Object(d.a)({},i,Object(p.a)({},t,!0)));var t}})})))},f=a(8),y=a.n(f),b=a(6),v=a(7),h=function(){function e(t){Object(b.a)(this,e),this.map=t.map,this.id=t.id,this.sourceId=t.sourceId,this.sourceLayer=t.sourceLayer,this.popupFieldsConfig=t.popupFieldsConfig||{},this._hoveredFeature=0,this._hoveredId=null,this._popupInfo={}}return Object(v.a)(e,[{key:"mouseMove",value:function(e){this.map.getCanvas().style.cursor="pointer",e.features.length>0&&(this._hoveredId&&this.map.setFeatureState({source:this.sourceId,id:this._hoveredId,sourceLayer:this.sourceLayer},{hover:!1}),this._hoveredId=e.features[0].id,this.map.setFeatureState({source:this.sourceId,id:this._hoveredId,sourceLayer:this.sourceLayer},{hover:!0}));for(var t=e.lngLat,a=Object.keys(this.popupFieldsConfig),o=e.features[0].properties,r=0,n=a;r<n.length;r++){var i=n[r];o.hasOwnProperty(i)&&(this._popupInfo=Object(d.a)({},this._popupInfo,{coords:[t.lng,t.lat],shouldRender:!0,info:Object(d.a)({},this._popupInfo.info,Object(p.a)({},i,Object(d.a)({},this.popupFieldsConfig[i],{value:o[i]})))}))}}},{key:"mouseLeave",value:function(){this.map.getCanvas().style.cursor="",this._popupInfo={shouldRender:!1},this._hoveredId&&this.map.setFeatureState({source:this.sourceId,id:this._hoveredId,sourceLayer:this.sourceLayer},{hover:!1}),this._hoveredId=null}},{key:"popupInfo",get:function(){return this._popupInfo}}]),e}();function g(e,t){var a=Object(o.useState)({shouldRender:!1}),n=Object(c.a)(a,2),i=n[0],s=n[1],l=Object(o.useState)(null),u=Object(c.a)(l,2),p=u[0],d=u[1];return r.a.useEffect((function(){return e&&t&&function(){for(var a=e,o=[],r=Object.values(t),n=0;n<r.length;n+=1)o.push(new h({map:a,id:r[n].id,sourceId:r[n].sourceId,sourceLayer:r[n].sourceLayer,popupFieldsConfig:r[n].popupFieldsConfig}));for(var i=function(e){a.on("mousemove",r[e].id,(function(t){o[e].mouseMove(t);var a=o[e].popupInfo;a&&s(a)})),a.on("mouseleave",r[e].id,(function(){o[e].mouseLeave();var t=o[e].popupInfo;t&&s(t)})),a.on("click",r[e].id,(function(e){0!==e.features.length&&d(e.features[0])}))},c=0;c<r.length;c+=1)i(c)}(),function(){!function(){for(var a=e,o=0,r=Object.values(t);o<r.length;o++){var n=r[o];a.off("mousemove",n),a.off("mouseleave",n)}}()}}),[e,t]),[i,p]}g.propTypes={map:y.a.instanceOf(s.Map).isRequired,layersIds:y.a.shape({cadastre_id:y.a.object}).isRequired};a(28);var _=function(e){var t=e.mapObject,a=r.a.useState(!0),o=Object(c.a)(a,2),n=o[0],i=o[1];return r.a.useEffect((function(){var e=!1;t&&t.once("styledata",(function(){!function a(){t.isStyleLoaded()?(e||i(!1),e=!0):setTimeout(a,200)}()}))}),[t]),r.a.createElement("div",{className:"".concat(n?"loader":"loader--close")},r.a.createElement("div",{className:"CDB-LoaderIcon CDB-LoaderIcon--big"},r.a.createElement("svg",{className:"CDB-LoaderIcon-spinner",viewBox:"0 0 50 50"},r.a.createElement("circle",{className:"CDB-LoaderIcon-path",cx:"25",cy:"25",r:"20",fill:"none"}))))};_.defaultProps={mapObject:s.Map};a(29);var I=r.a.memo((function(e){var t=e.content,a=r.a.useState([]),n=Object(c.a)(a,2),i=n[0],s=n[1];r.a.useEffect((function(){t&&s(Object.values(t))}),[t]);return r.a.createElement("div",{className:"popup-template"},i&&i.map((function(e,t){return r.a.createElement(o.Fragment,{key:"dynamic-".concat(t)},r.a.createElement("span",{className:"popup-template--static popup-template--static-".concat(t+1)},e.fieldLabel),r.a.createElement("div",{className:"popup-template--dynamic popup-template--dynamic-".concat(t+1)},r.a.createElement("span",null,"number"===typeof(a=e.value)?"".concat(new Intl.NumberFormat("es").format(a)):a),r.a.createElement("span",null,e.label)));var a})))}),(function(e,t){return e.content===t.content})),O=(a(30),a(31),function(e){var t=e.map,a=e.layers,o=r.a.useState(null),n=Object(c.a)(o,2),i=n[0],s=n[1];r.a.useEffect((function(){if(a){var e=!0,t=!1,o=void 0;try{for(var r,n=a[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var i=r.value;i.shouldShowOnInit&&s(i.layersIds[0])}}catch(c){t=!0,o=c}finally{try{e||null==n.return||n.return()}finally{if(t)throw o}}}}),[]);var l=function(e){var o=e.target.name;s(o);var r=!0,n=!1,i=void 0;try{for(var c,l=a[Symbol.iterator]();!(r=(c=l.next()).done);r=!0){var u=c.value,p=!0,d=!1,m=void 0;try{for(var f,y=u.layersIds[Symbol.iterator]();!(p=(f=y.next()).done);p=!0){var b=f.value;t.getLayer(b)&&("visible"===t.getLayoutProperty(b,"visibility")?t.setLayoutProperty(b,"visibility","none"):t.setLayoutProperty(b,"visibility","visible"))}}catch(v){d=!0,m=v}finally{try{p||null==y.return||y.return()}finally{if(d)throw m}}}}catch(v){n=!0,i=v}finally{try{r||null==l.return||l.return()}finally{if(n)throw i}}};return r.a.createElement("div",{className:"layers-picker"},i&&a.map((function(e,t){return r.a.createElement("div",{key:e.layersIds[0],className:"as-radio"},r.a.createElement("input",{className:"as-radio__input",type:"radio",name:e.layersIds[0],id:e.layersIds[0],value:t,checked:i===e.layersIds[0],onClick:l}),r.a.createElement("label",{className:"as-caption",htmlFor:e.layersIds[0]},e.layerTitle))})))}),j="dotgis",E="wqTxcWJUw09P4IzpBo4kfg",k="voronoi",L="voronoi_source",w="voronoi_source_layer",S="pharmacy",C="pharmacy_source_id",F="pharmacy_source_layer",T="pharmacy_aggregated",x="supermarkets_voronoi",M="supermarkets_voronoi_source_id",q="supermarkets_voronoi_source_layer",N="supermarkets",A="supermarkets_source_id",B="supermarkets_source_layer",K="supermarkets_aggregated",R=function(e){var t=e.map,a=e.config,o=g(t,a),n=Object(c.a)(o,2),i=n[0],s=n[1];return r.a.useEffect((function(){if(s&&s.source===C){var e=s.geometry.coordinates;t.flyTo({center:e,zoom:Math.round(t.getZoom()+2),essential:!0})}}),[s]),r.a.createElement(r.a.Fragment,null,Object.values(a).map((function(e){return r.a.createElement(u.a,{key:e.id,id:e.id,type:e.type,sourceId:e.sourceId,sourceLayer:e.sourceLayer,paint:e.paint,layout:e.layout||void 0,minZoom:e.minZoom||void 0,maxZoom:e.maxZoom||void 0})})),i&&i.coords&&r.a.createElement(u.c,{coordinates:i.coords,style:{display:i.shouldRender?"":"none"},offset:{bottom:[0,80]}},r.a.createElement(I,{content:i.info})))},z=a(9),J=a.n(z),P=a(14),Z="SELECT * FROM voronoi_farmacias",D="SELECT * FROM farmacias",G="SELECT * FROM voronoi_supermkt_madrid",W="SELECT * FROM supermercados_madrid",Y={voronoi:{"fill-color":["case",["boolean",["feature-state","hover"],!1],"rgba(204, 102, 255, 0.15)","rgba(204, 102, 255, 0.1)"],"fill-outline-color":"rgba(204, 102, 255, 0.3)"},cluster:function(e){return{"circle-color":["step",["get",e],"rgba(0, 0, 0, 0)",100,"#b4d9cc",750,"#63a6a0",2e3,"#287274"],"circle-radius":["case",[">",["get",e],1],["step",["get",e],20,100,30,750,40],6]}},pharmacy:{"circle-color":["case",["boolean",["feature-state","hover"],!1],"rgb(255, 102, 0)","rgb(0, 255, 0)"],"circle-radius":["interpolate",["exponential",.7],["zoom"],10,0,20,5]},supermarket:{"circle-color":["case",["boolean",["feature-state","hover"],!1],"rgb(255, 102, 0)","rgb(0, 102, 255)"],"circle-radius":["interpolate",["exponential",.7],["zoom"],10,0,20,5]},label_paint:function(e){return{textColor:{"text-color":["case",[">",["get",e],100],"#333","rgba(0, 0, 0, 0)"]},layout:{"text-field":"{".concat(e,"}"),"text-font":["DIN Offc Pro Medium","Arial Unicode MS Bold"],"text-size":["step",["get",e],12,100,13,750,14],"text-allow-overlap":!0}}}},U=function(){function e(t){Object(b.a)(this,e),this.cartoAccount=t.cartoAccount,this.cartoMapsKey=t.cartoMapsKey,this.id=t.id,this.sql=t.sql,this.getGeoJSON=t.getGeoJSON,this.aggregationConfig=t.aggregationConfig}return Object(v.a)(e,[{key:"getTiles",value:function(){var e=Object(P.a)(J.a.mark((function e(){var t,a,o;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={buffersize:{mvt:1},layers:[{id:this.id,type:"mapnik",options:{sql:this.sql,aggregation:this.aggregationConfig||void 0,id:"cartodb_id"}}]},e.next=3,fetch("https://".concat(this.cartoAccount,".carto.com/api/v1/map").concat(this.cartoMapsKey?"?api_key=".concat(this.cartoMapsKey):""),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});case 3:return a=e.sent,e.next=6,a.json();case 6:return o=e.sent,e.abrupt("return",o.metadata.tilejson.vector.tiles);case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"requestInfo",get:function(){return{carto_account:this.cartoAccount,carto_maps_key:this.cartoMapsKey,request_id:this.id,sql_query:this.sql,aggregation_config:this.aggregationConfig||void 0}}},{key:"updateSql",set:function(e){this.sql=e}}]),e}();function Q(e){var t=Object(o.useState)(null),a=Object(c.a)(t,2),n=a[0],i=a[1],s=function(){var e=Object(P.a)(J.a.mark((function e(){var t,a,o,r,n,c;return J.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new U({cartoAccount:j,cartoMapsKey:E,id:w,sql:Z}),a=new U({cartoAccount:j,cartoMapsKey:E,id:F,sql:D,aggregationConfig:{threshold:1,placement:"centroid",columns:Object(p.a)({},T,{aggregate_function:"count",aggregated_column:"rid"}),filters:Object(p.a)({},T,{greater_than:1}),resolution:64}}),o=new U({cartoAccount:j,cartoMapsKey:E,id:"".concat(F,"_raw"),sql:D}),r=new U({cartoAccount:j,cartoMapsKey:E,id:"".concat(B,"_raw"),sql:W}),n=new U({cartoAccount:j,cartoMapsKey:E,id:B,sql:W,aggregationConfig:{threshold:1,placement:"centroid",columns:Object(p.a)({},K,{aggregate_function:"count",aggregated_column:"id_super"}),filters:Object(p.a)({},K,{greater_than:1}),resolution:64}}),c=new U({cartoAccount:j,cartoMapsKey:E,id:q,sql:G}),Promise.all([t.getTiles(),a.getTiles(),o.getTiles(),r.getTiles(),n.getTiles(),c.getTiles()]).then((function(e){i({voronoi_id:{isSource:!0,id:k,sourceId:L,sourceLayer:w,pbf:e[0],promoteId:"cartodb_id",type:"fill",paint:Y.voronoi,layout:{visibility:"visible"}},pharmacy_id_raw:{isSource:!0,id:"".concat(S,"_raw"),sourceId:"".concat(C,"_raw"),sourceLayer:"".concat(F,"_raw"),pbf:e[2],promoteId:"cartodb_id",type:"circle",paint:Y.pharmacy,popupFieldsConfig:{nombre:{fieldLabel:"Nombre",label:""},direccion:{fieldLabel:"Direcci\xf3n",label:""}},layout:{visibility:"visible"}},pharmacy_id:{isSource:!0,id:S,sourceId:C,sourceLayer:F,pbf:e[1],promoteId:"cartodb_id",type:"circle",paint:Y.cluster(T),layout:{visibility:"visible"}},pharmacy_labels_id:{id:"".concat(S,"_labels"),sourceId:C,sourceLayer:F,pbf:e[1],promoteId:"cartodb_id",type:"symbol",paint:Y.label_paint(T).textColor,layout:Object(d.a)({visibility:"visible"},Y.label_paint(T).layout)},supermarkets_voronoi_id:{isSource:!0,id:x,sourceId:M,sourceLayer:q,pbf:e[5],promoteId:"cartodb_id",type:"fill",paint:Y.voronoi,layout:{visibility:"none"}},supermarket_id_raw:{isSource:!0,id:"".concat(N,"_raw"),sourceId:"".concat(A,"_raw"),sourceLayer:"".concat(B,"_raw"),pbf:e[3],promoteId:"cartodb_id",type:"circle",paint:Y.supermarket,popupFieldsConfig:{nombre:{fieldLabel:"Nombre",label:""},direccion:{fieldLabel:"Direcci\xf3n",label:""}},layout:{visibility:"none"}},supermarket_id:{isSource:!0,id:N,sourceId:A,sourceLayer:B,pbf:e[4],promoteId:"cartodb_id",type:"circle",paint:Y.cluster(K),layout:{visibility:"none"}},supermarket_labels_id:{id:"".concat(N,"_labels"),sourceId:A,sourceLayer:B,pbf:e[4],promoteId:"cartodb_id",type:"symbol",paint:Y.label_paint(K).textColor,layout:Object(d.a)({visibility:"none"},Y.label_paint(K).layout)}})}));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.useEffect((function(){s(e)}),[e]),[n]}Q.propTypes={mapFilters:y.a.oneOfType([y.a.object]).isRequired};var V=Object(u.f)({accessToken:"pk.eyJ1IjoiZG90Z2lzIiwiYSI6ImNqd3Z6amtjMTBjOTA0OW84ZjVvYzF6bjQifQ.LIbUaYq3GaiWTzsBV6YnTA"}),$=[{shouldShowOnInit:!0,layersIds:[S,k,"".concat(S,"_raw"),"".concat(S,"_labels")],layerTitle:"Farmacias",layerColor:"rgb(0, 255, 0)"},{shouldShowOnInit:!1,layersIds:[N,x,"".concat(N,"_raw"),"".concat(N,"_labels")],layerTitle:"Supermercados",layerColor:"rgb(0, 102, 255)"}],H=function(e){var t=e.mapFilters,a=r.a.useState(!1),o=Object(c.a)(a,2),n=o[0],i=o[1],s=r.a.useState(null),p=Object(c.a)(s,2),d=p[0],f=p[1],y=Q(t),b=Object(c.a)(y,1)[0];return r.a.createElement(r.a.Fragment,null,(!!l.a.supported()||(alert("Tu navegador no soporta Mapbox GL JS."),!1))&&r.a.createElement(r.a.Fragment,null,d&&r.a.createElement(r.a.Fragment,null,r.a.createElement(_,{mapObject:d}),r.a.createElement(O,{key:"layer-picker",map:d,layers:$})),r.a.createElement(V,{style:"mapbox://styles/mapbox/dark-v10",fitBounds:[[-4.2129351236574735,40.23670360815473],[-3.1320186657642637,40.64109281781327]],containerStyle:{position:"absolute",width:"100%",height:"100%"}},r.a.createElement(u.b.Consumer,null,(function(e){return f(e),r.a.createElement(r.a.Fragment,null,b&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m,{key:"sources",config:b,sourceLoad:function(e){return i(e)}}),n&&r.a.createElement(r.a.Fragment,null,r.a.createElement(R,{key:"map",map:e,config:b})),r.a.createElement(u.e,{key:"zoom-control",position:"bottom-left"})))})))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(H,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.64f059d0.chunk.js.map